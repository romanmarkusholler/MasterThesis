// Rescue-Prime definition according to https://eprint.iacr.org/2020/1143
// Taken and adapted from https://github.com/novifinancial/winterfell/blob/main/examples/src/rescue/rescue.rs
// Parameters derived using https://github.com/KULeuven-COSIC/Marvellous

// Parameters
//   p   .. 4611624995532046337 (prime from winterfell::math::fields::f62)
//   m   .. 17
//   c_p .. 1
//   security at least 128 bit

use winterfell::math::{fields::f62::BaseElement, FieldElement};

pub type Elem = BaseElement;

// RESCUE CONSTANTS
// ================================================================================================

pub const NUM_ROUNDS: usize = 8;
pub const STATE_WIDTH: usize = 17;
pub const CAPACITY: usize = 1;
pub const RATE: usize = STATE_WIDTH - CAPACITY;
const ALPHA: u32 = 3;
const INV_ALPHA: u64 = 3074416663688030891;

const MDS: [Elem; STATE_WIDTH * STATE_WIDTH] = [
    Elem::new(1155881039110967940),
    Elem::new(423787264258320253),
    Elem::new(3819801824360318772),
    Elem::new(2801729138631193849),
    Elem::new(4255288233527967463),
    Elem::new(2677947943557393784),
    Elem::new(310156690184296038),
    Elem::new(3762179861686894788),
    Elem::new(2845551353273621339),
    Elem::new(1596519804678484325),
    Elem::new(4052920154935608625),
    Elem::new(1355531109652639659),
    Elem::new(4457116607914048682),
    Elem::new(474447710255971853),
    Elem::new(2905183551988017366),
    Elem::new(4610582671708102217),
    Elem::new(64570081),
    Elem::new(194569498444225176),
    Elem::new(2957945657081493218),
    Elem::new(4338016713292647696),
    Elem::new(3020800084394439447),
    Elem::new(2185181167086938752),
    Elem::new(1127475864451416694),
    Elem::new(1368867767947945343),
    Elem::new(3861954435477046040),
    Elem::new(1435855502263439356),
    Elem::new(3952246074707376009),
    Elem::new(1887664021978234425),
    Elem::new(1340635912711742837),
    Elem::new(1137066798371230935),
    Elem::new(625914960142222024),
    Elem::new(817425493733138143),
    Elem::new(2026628045104385824),
    Elem::new(3126971536402441),
    Elem::new(3335901091880207629),
    Elem::new(802954589709240435),
    Elem::new(4069203047349780129),
    Elem::new(12974723191779761),
    Elem::new(3825111689641307823),
    Elem::new(1086793661813529126),
    Elem::new(2555213062284778604),
    Elem::new(2364966113192981058),
    Elem::new(1536915682915952011),
    Elem::new(1955641496845171308),
    Elem::new(1275737129706899115),
    Elem::new(4366646751162633160),
    Elem::new(2500482410219680505),
    Elem::new(4218790606000312479),
    Elem::new(3701117339767526239),
    Elem::new(3841336698523056978),
    Elem::new(54838865583580674),
    Elem::new(2115176517500445751),
    Elem::new(3807825852463463323),
    Elem::new(3693652167065956659),
    Elem::new(571764004173286430),
    Elem::new(873926082595434745),
    Elem::new(1875496405134157421),
    Elem::new(3614226037045910144),
    Elem::new(4601860293047136457),
    Elem::new(4246780213138938364),
    Elem::new(2411017143111336813),
    Elem::new(248958561005653736),
    Elem::new(706246905707263295),
    Elem::new(2904573239360962906),
    Elem::new(852550108271585607),
    Elem::new(712841876615651304),
    Elem::new(3065657305308947554),
    Elem::new(590447252710240188),
    Elem::new(4208778478677950036),
    Elem::new(4032922347776519706),
    Elem::new(4497706105383010265),
    Elem::new(3216731901924088988),
    Elem::new(1696962577650020532),
    Elem::new(2741461089146162644),
    Elem::new(2636912338303879435),
    Elem::new(1831092091195940428),
    Elem::new(2953843636940373856),
    Elem::new(3361396967030986585),
    Elem::new(1459181232876758298),
    Elem::new(1430230273527295714),
    Elem::new(2293466992552638093),
    Elem::new(4426002235624355689),
    Elem::new(1913526334639615318),
    Elem::new(4191337897302597739),
    Elem::new(3836322450300316382),
    Elem::new(4453317437856455090),
    Elem::new(3285741560524518944),
    Elem::new(536144967553445119),
    Elem::new(4022689542150169265),
    Elem::new(3914919829318171030),
    Elem::new(547587472720179302),
    Elem::new(1543588223859143228),
    Elem::new(4566547699538677141),
    Elem::new(3041301876147830224),
    Elem::new(3480822532972088970),
    Elem::new(1507260770258153035),
    Elem::new(229753934231492029),
    Elem::new(199352663537120661),
    Elem::new(2629669689214757995),
    Elem::new(1283534791350950027),
    Elem::new(2649174766231322874),
    Elem::new(3613217202323942100),
    Elem::new(3385211924948859971),
    Elem::new(4245192565532673372),
    Elem::new(203533683954420284),
    Elem::new(3967514184848513243),
    Elem::new(4249447725557568514),
    Elem::new(4128840813260133366),
    Elem::new(1769282349556331535),
    Elem::new(1876297416015090963),
    Elem::new(3176545802523492373),
    Elem::new(1666671714684079660),
    Elem::new(3457736313584202376),
    Elem::new(3382234258479311477),
    Elem::new(1300459791903822145),
    Elem::new(1217009304481147775),
    Elem::new(2582950068587395940),
    Elem::new(4083084658380991948),
    Elem::new(1424237379022428429),
    Elem::new(1445923791739470384),
    Elem::new(2899040348471562302),
    Elem::new(1000269232711375204),
    Elem::new(3119177992267895293),
    Elem::new(4079275785286700070),
    Elem::new(4590736753596570818),
    Elem::new(1013786374962680551),
    Elem::new(2187872177555589044),
    Elem::new(659166395599683690),
    Elem::new(277332881391153441),
    Elem::new(1792505417591405675),
    Elem::new(3685856066569442352),
    Elem::new(4172232749062066079),
    Elem::new(3845340489729751101),
    Elem::new(4328721592667186508),
    Elem::new(1068998256577022981),
    Elem::new(1338388654008861541),
    Elem::new(3005754842118960786),
    Elem::new(4011636363823565690),
    Elem::new(233804590474679117),
    Elem::new(1696670861789893048),
    Elem::new(1973787974038221252),
    Elem::new(2287969734094958658),
    Elem::new(2477750349826169948),
    Elem::new(4086894945644236049),
    Elem::new(307454910846068792),
    Elem::new(1850842174397660837),
    Elem::new(1719788684333356566),
    Elem::new(2108684378529879375),
    Elem::new(2061815649128505021),
    Elem::new(747247004495206984),
    Elem::new(2735237296875381502),
    Elem::new(914101261353811686),
    Elem::new(61933946953769049),
    Elem::new(2024325803775549325),
    Elem::new(984268184935278177),
    Elem::new(4230241101378813162),
    Elem::new(2593478575039863073),
    Elem::new(4378814259434372005),
    Elem::new(4358036154081994101),
    Elem::new(848633742370076596),
    Elem::new(2134889890808634285),
    Elem::new(3677418956929109241),
    Elem::new(682154742976429381),
    Elem::new(1990650201570138679),
    Elem::new(2769664095294549723),
    Elem::new(2068668928146347155),
    Elem::new(302468692649593361),
    Elem::new(2607246695714668697),
    Elem::new(1650359613798160719),
    Elem::new(4203305320884839354),
    Elem::new(3521391455831929212),
    Elem::new(2659056156793256990),
    Elem::new(1268235496531662464),
    Elem::new(4242588486031489096),
    Elem::new(4414007554387981915),
    Elem::new(4070505446612886745),
    Elem::new(298664984264159379),
    Elem::new(250336665163786768),
    Elem::new(4469041657916778264),
    Elem::new(1665407847497646848),
    Elem::new(1343473920142020454),
    Elem::new(4375605570405275097),
    Elem::new(3350789751728139715),
    Elem::new(118477216773520339),
    Elem::new(3346646563520497627),
    Elem::new(2984944218822926237),
    Elem::new(3737076962896506221),
    Elem::new(4565950270577631240),
    Elem::new(1455636689730703087),
    Elem::new(1314417873069996525),
    Elem::new(4563713807358541087),
    Elem::new(3297098655341489226),
    Elem::new(4511392046861762115),
    Elem::new(3884412474264295202),
    Elem::new(1829590026819219575),
    Elem::new(4490386564851106293),
    Elem::new(232813602288703497),
    Elem::new(324514333430471554),
    Elem::new(2812530306707659531),
    Elem::new(3814605937759846417),
    Elem::new(1744790954062816186),
    Elem::new(1657150377582255652),
    Elem::new(1335304658644425112),
    Elem::new(4281941375969541072),
    Elem::new(1546727954602273001),
    Elem::new(799846097400277520),
    Elem::new(1569012901286883676),
    Elem::new(1967878741288341948),
    Elem::new(3521417568146272177),
    Elem::new(263216022346981173),
    Elem::new(3746504065160169783),
    Elem::new(1756553095905871988),
    Elem::new(1535082486818882653),
    Elem::new(1566432064946623375),
    Elem::new(2878262259433161172),
    Elem::new(3705145810373510554),
    Elem::new(3580725458556664696),
    Elem::new(399064000449978933),
    Elem::new(4562985918947718279),
    Elem::new(1094614508036317107),
    Elem::new(2399531010556442662),
    Elem::new(1295569677566957997),
    Elem::new(3569956519390721546),
    Elem::new(2048753745220355923),
    Elem::new(1862797492982804336),
    Elem::new(4477272467869879354),
    Elem::new(375208197911623445),
    Elem::new(4291812178511500116),
    Elem::new(1724549242752871114),
    Elem::new(4090889325413760752),
    Elem::new(1167821004743400855),
    Elem::new(2998710621783579829),
    Elem::new(760662811033981434),
    Elem::new(996156276380765995),
    Elem::new(3439682392143440046),
    Elem::new(1204266533972948841),
    Elem::new(3050149659047993298),
    Elem::new(4150366813061832153),
    Elem::new(4422494359969019228),
    Elem::new(3283684936840765386),
    Elem::new(2809367344488639701),
    Elem::new(938984016623628976),
    Elem::new(3075517429764207154),
    Elem::new(408144075950622161),
    Elem::new(725117757734395802),
    Elem::new(988618908618446194),
    Elem::new(314534663770353332),
    Elem::new(2913772749748893339),
    Elem::new(2598566567286028999),
    Elem::new(3477479449938700239),
    Elem::new(1779486334378435692),
    Elem::new(3824264989025559837),
    Elem::new(2054695054183598247),
    Elem::new(3977116771970887077),
    Elem::new(3912779549496235670),
    Elem::new(2241178941525076333),
    Elem::new(4459553762480915130),
    Elem::new(3514565650642521584),
    Elem::new(2546041284228405159),
    Elem::new(2844064934728020850),
    Elem::new(663340753044376127),
    Elem::new(2863159082862180724),
    Elem::new(717006815925190853),
    Elem::new(3444930394810359010),
    Elem::new(1878781109215886518),
    Elem::new(1704297854816601176),
    Elem::new(3422307223155788973),
    Elem::new(1171064375276836793),
    Elem::new(495019925838498221),
    Elem::new(3046993315628550185),
    Elem::new(3407059877098087209),
    Elem::new(3085259658511122189),
    Elem::new(4418429008623305261),
    Elem::new(2438765211918190178),
    Elem::new(1761868554561646602),
    Elem::new(3314330905702086553),
    Elem::new(1535263422907097012),
    Elem::new(2420571131547214778),
    Elem::new(290578658798343001),
    Elem::new(4145976787141774153),
    Elem::new(4253333957976842356),
    Elem::new(2167250324085807898),
    Elem::new(4197084596163970787),
    Elem::new(3343600708025399301),
    Elem::new(241163236002442906),
    Elem::new(2147612770012740686),
    Elem::new(2379407443429153797),
    Elem::new(4432348787152481564),
    Elem::new(2628664451271966538),
];

const INV_MDS: [Elem; STATE_WIDTH * STATE_WIDTH] = [
    Elem::new(2669483462044187574),
    Elem::new(3798445136269875736),
    Elem::new(4540047421065702070),
    Elem::new(1719044012051488038),
    Elem::new(3089113399010433632),
    Elem::new(3222511924581841333),
    Elem::new(342602042971792987),
    Elem::new(4441707156185853835),
    Elem::new(2330777740609600324),
    Elem::new(1263421160438582286),
    Elem::new(3196011569704548908),
    Elem::new(3410280811504677004),
    Elem::new(58772166315420080),
    Elem::new(3671670263234461961),
    Elem::new(4365796298624718927),
    Elem::new(2968589978277328123),
    Elem::new(1027975412429950553),
    Elem::new(2075784468895467721),
    Elem::new(1965576814741171770),
    Elem::new(2166818452312431810),
    Elem::new(4215302781197950934),
    Elem::new(160128206728496505),
    Elem::new(3036649909108241791),
    Elem::new(4530431656489183166),
    Elem::new(3812797787565501951),
    Elem::new(4389904536833409529),
    Elem::new(1122527235396944447),
    Elem::new(3471508912054400075),
    Elem::new(950890105658341018),
    Elem::new(3645307222695125987),
    Elem::new(4563686057958433668),
    Elem::new(1967422359686633147),
    Elem::new(1358254602910075666),
    Elem::new(2683258845088654186),
    Elem::new(2229368797928354285),
    Elem::new(960751605252516180),
    Elem::new(1384980220851742915),
    Elem::new(2224732643163210410),
    Elem::new(394683647247905881),
    Elem::new(2012604247120661872),
    Elem::new(3438381214438025236),
    Elem::new(2484076463914564292),
    Elem::new(461974159235658458),
    Elem::new(1869168668010803163),
    Elem::new(4536299172198882075),
    Elem::new(476546595960132795),
    Elem::new(3706859217438420653),
    Elem::new(758368650615536528),
    Elem::new(2379639689704237803),
    Elem::new(4436733992118580012),
    Elem::new(3137830979057138139),
    Elem::new(3395361535527109666),
    Elem::new(311855608582705648),
    Elem::new(4204184089111058372),
    Elem::new(4190735854306545257),
    Elem::new(772450605064797814),
    Elem::new(2324800815096692229),
    Elem::new(4395342788033916566),
    Elem::new(3261165799667394611),
    Elem::new(1444669952266288379),
    Elem::new(2007775526662364474),
    Elem::new(2514111821714311177),
    Elem::new(984853781262818341),
    Elem::new(4054235079417599895),
    Elem::new(1289435368817560819),
    Elem::new(1619613099375849560),
    Elem::new(799722674201984569),
    Elem::new(3934310560679419657),
    Elem::new(776169829325842640),
    Elem::new(1045935063862229703),
    Elem::new(3470314611462352092),
    Elem::new(1081073482903984333),
    Elem::new(2364658366158550121),
    Elem::new(4475372702857964227),
    Elem::new(1367910656952446718),
    Elem::new(3016283281062459970),
    Elem::new(1759318617638055667),
    Elem::new(4005506974961803414),
    Elem::new(1889977380823785836),
    Elem::new(3261710070080959576),
    Elem::new(4106762926311628769),
    Elem::new(2070342769193222648),
    Elem::new(1071358173712780308),
    Elem::new(4062107450804761100),
    Elem::new(1679822601675589912),
    Elem::new(3133614488560533737),
    Elem::new(340751239812325335),
    Elem::new(4053363986456050145),
    Elem::new(4089238488722249986),
    Elem::new(421007704791015146),
    Elem::new(3806991589639649309),
    Elem::new(4598447382218696383),
    Elem::new(3389805965478922722),
    Elem::new(4019098242223202825),
    Elem::new(2279300279234238192),
    Elem::new(2078967557852890377),
    Elem::new(655141462992659684),
    Elem::new(186364472045325536),
    Elem::new(2923352118092922938),
    Elem::new(472640598821993244),
    Elem::new(1807396250039262522),
    Elem::new(3249143132806478953),
    Elem::new(1967668067196731147),
    Elem::new(4073311465676600124),
    Elem::new(1306665357692727790),
    Elem::new(1634370617411237356),
    Elem::new(1889210611752099118),
    Elem::new(3548022994903941135),
    Elem::new(3201704119007294923),
    Elem::new(1403531900207762490),
    Elem::new(3088469830035970969),
    Elem::new(2470689687274009847),
    Elem::new(3177462162945014117),
    Elem::new(2279408151359300976),
    Elem::new(4286336818200597729),
    Elem::new(1088179824771297243),
    Elem::new(1671753425656729738),
    Elem::new(2630899201262806570),
    Elem::new(1786940724434295762),
    Elem::new(4308474673289345390),
    Elem::new(486165705289512150),
    Elem::new(4051489154764457899),
    Elem::new(131263684820069810),
    Elem::new(2193468686661117590),
    Elem::new(2025487069659778644),
    Elem::new(1131126844957503346),
    Elem::new(1578725448851197893),
    Elem::new(2974366570882005665),
    Elem::new(2051475819507020719),
    Elem::new(2362911354966868252),
    Elem::new(18083277979281189),
    Elem::new(85426977144032061),
    Elem::new(1794038527804383926),
    Elem::new(1985223119333323755),
    Elem::new(3269914445225572486),
    Elem::new(1833733607588853585),
    Elem::new(3534300405505059639),
    Elem::new(3878195056885465736),
    Elem::new(2840066935494721360),
    Elem::new(1822721221288940423),
    Elem::new(3971040285978348993),
    Elem::new(2590010627405984660),
    Elem::new(3835342442301447379),
    Elem::new(1560294659564571276),
    Elem::new(3839985674076350108),
    Elem::new(1798096203902835009),
    Elem::new(496616665776368597),
    Elem::new(3004394168511284550),
    Elem::new(3634639781421592197),
    Elem::new(1641111158844745594),
    Elem::new(4353272622610215254),
    Elem::new(1994347568509463407),
    Elem::new(1321814477243069189),
    Elem::new(3788458034425160925),
    Elem::new(1410320995427539586),
    Elem::new(1760087040892675671),
    Elem::new(365960452773748788),
    Elem::new(202190089337985058),
    Elem::new(1119688388739930645),
    Elem::new(2653774132438850438),
    Elem::new(3289738132873653127),
    Elem::new(608159716094754013),
    Elem::new(3476739524442666502),
    Elem::new(1439876697795371035),
    Elem::new(2749294711753746714),
    Elem::new(1665556983083972798),
    Elem::new(2833768804276414494),
    Elem::new(3655368771401856423),
    Elem::new(4068421615476459612),
    Elem::new(1805595873021584868),
    Elem::new(2953947736724126259),
    Elem::new(2945981184342854364),
    Elem::new(4166746635265081735),
    Elem::new(244572538683864309),
    Elem::new(4575753007720346369),
    Elem::new(162761746288845798),
    Elem::new(3394567236109745254),
    Elem::new(4028170186412957280),
    Elem::new(3971034976368175042),
    Elem::new(818921216142935598),
    Elem::new(2838883589658335948),
    Elem::new(48267738253528982),
    Elem::new(4242341821102416284),
    Elem::new(998447164374208107),
    Elem::new(4193444529549517507),
    Elem::new(4477887294943497396),
    Elem::new(2054521353380027139),
    Elem::new(3062228450520727416),
    Elem::new(2951914577587305019),
    Elem::new(1308853755980507288),
    Elem::new(1010096173317739590),
    Elem::new(97671655161987126),
    Elem::new(3161002421595060591),
    Elem::new(1679923521783121223),
    Elem::new(2331299438316954716),
    Elem::new(1717939740274511490),
    Elem::new(1095183848297607268),
    Elem::new(1168768373695159950),
    Elem::new(1306730218241670621),
    Elem::new(719755387855922812),
    Elem::new(833967612728703284),
    Elem::new(1192117609585025383),
    Elem::new(4151654233227717333),
    Elem::new(4492267950554603250),
    Elem::new(4271158531242847202),
    Elem::new(737244726585080303),
    Elem::new(579034775398189859),
    Elem::new(1590369647616256385),
    Elem::new(4230462331575525976),
    Elem::new(4120312860461659926),
    Elem::new(260568760088414753),
    Elem::new(2790789521000671216),
    Elem::new(4151207627891126601),
    Elem::new(217706902497501727),
    Elem::new(1548928224209579280),
    Elem::new(681764816843775044),
    Elem::new(2247099947887885354),
    Elem::new(1037091360186505149),
    Elem::new(2932351568368791271),
    Elem::new(3054335063021485009),
    Elem::new(2442573299381075642),
    Elem::new(4422753235365393006),
    Elem::new(4356489508109357469),
    Elem::new(2726929034374684699),
    Elem::new(3942159641278424725),
    Elem::new(1226798448977659285),
    Elem::new(2098083443278324818),
    Elem::new(2638854883297073251),
    Elem::new(1433051046385128724),
    Elem::new(1861909529392001201),
    Elem::new(4547073159437560187),
    Elem::new(2651453070879549922),
    Elem::new(3298376451392737320),
    Elem::new(2886568731511150131),
    Elem::new(2249413411647825357),
    Elem::new(2430921222559717),
    Elem::new(2119418462987664881),
    Elem::new(3654486975783368678),
    Elem::new(1684402875395976563),
    Elem::new(3883335853961870811),
    Elem::new(4060538742136568957),
    Elem::new(24728679267000946),
    Elem::new(4002730908566371117),
    Elem::new(1398419278232280775),
    Elem::new(1498128157682136069),
    Elem::new(1755555471669670888),
    Elem::new(1463685019809608428),
    Elem::new(436455158882564461),
    Elem::new(3233982448227766022),
    Elem::new(4045400877557191311),
    Elem::new(544678112424657824),
    Elem::new(2090909960265356586),
    Elem::new(3808070662393537944),
    Elem::new(63038086369493495),
    Elem::new(2898939671414318500),
    Elem::new(562061092704714927),
    Elem::new(366773594300999379),
    Elem::new(4366113574151265758),
    Elem::new(1247774601109365273),
    Elem::new(2476455336382195308),
    Elem::new(1819672792067096557),
    Elem::new(1654596417882521820),
    Elem::new(1095349044352644555),
    Elem::new(2379906217089777699),
    Elem::new(960324579701947205),
    Elem::new(2855346446181749249),
    Elem::new(2489895936513908888),
    Elem::new(4516940413356683787),
    Elem::new(4277546319250154401),
    Elem::new(2577104824027246839),
    Elem::new(4011911573965701525),
    Elem::new(3846852196750443864),
    Elem::new(301801085468581771),
    Elem::new(3830844973823646869),
    Elem::new(291138094346587746),
    Elem::new(2092803388297083877),
    Elem::new(177657226107451042),
    Elem::new(4477943597443224060),
    Elem::new(4430372444728109019),
    Elem::new(4216934251104866383),
    Elem::new(667097517376061447),
    Elem::new(767554519448634929),
    Elem::new(500849458453600450),
    Elem::new(3180222024093673684),
    Elem::new(3942741857928478467),
    Elem::new(1497930055511438528),
    Elem::new(2151904555629760915),
    Elem::new(58186117722662503),
    Elem::new(4307018796772509007),
];

const ROUND_CONSTANTS: [Elem; STATE_WIDTH * 2 * NUM_ROUNDS] = [
    Elem::new(4507767470632503485),
    Elem::new(538051326013326037),
    Elem::new(1017735246946361723),
    Elem::new(3507741248240020224),
    Elem::new(4069155336114351165),
    Elem::new(2806701152989318584),
    Elem::new(4139566839422630095),
    Elem::new(3224819828998426977),
    Elem::new(2310352030973410739),
    Elem::new(4602956451009590318),
    Elem::new(1344895315532234577),
    Elem::new(3827491368620802283),
    Elem::new(1674859225843954307),
    Elem::new(2752345287274920368),
    Elem::new(4548396393981852497),
    Elem::new(4272215358996199835),
    Elem::new(3675489722915968988),
    Elem::new(1419278928477247602),
    Elem::new(2404271823334065137),
    Elem::new(3620438849023489558),
    Elem::new(2732363544614521040),
    Elem::new(3044140428410916280),
    Elem::new(2958738255196928609),
    Elem::new(1769482170515404908),
    Elem::new(122841655403598844),
    Elem::new(1904298765088123327),
    Elem::new(867522822709786296),
    Elem::new(2830104270273392753),
    Elem::new(2947774108687145977),
    Elem::new(3333208738710837329),
    Elem::new(2153919423890268089),
    Elem::new(851211526557828586),
    Elem::new(476003954134587083),
    Elem::new(3361355462091327757),
    Elem::new(168712711222966624),
    Elem::new(814056759028337888),
    Elem::new(4244094630139653192),
    Elem::new(2731239848256437550),
    Elem::new(4540815733779543294),
    Elem::new(4167796764540668816),
    Elem::new(1431748013190457177),
    Elem::new(2511902102919335272),
    Elem::new(2753941331901512360),
    Elem::new(3768175079355520092),
    Elem::new(3817465115623715732),
    Elem::new(2002238244043470715),
    Elem::new(1306170146499858084),
    Elem::new(966551752403957459),
    Elem::new(3533365215729772613),
    Elem::new(1289317896598302526),
    Elem::new(4253710486392733859),
    Elem::new(1405725554386495818),
    Elem::new(593184072271119876),
    Elem::new(2485270443417955625),
    Elem::new(2741803566734287379),
    Elem::new(1810151538719016700),
    Elem::new(4016400943329478790),
    Elem::new(3487371040356639526),
    Elem::new(2897405373275840353),
    Elem::new(4168843466409178440),
    Elem::new(1289103598577764077),
    Elem::new(1743172048477766441),
    Elem::new(3361584326726975238),
    Elem::new(3681317827479422116),
    Elem::new(4577478708351342167),
    Elem::new(2204412479934774712),
    Elem::new(634961667619908574),
    Elem::new(2933764157467580382),
    Elem::new(126448499345925010),
    Elem::new(1436354288907761985),
    Elem::new(272426923401913485),
    Elem::new(3373477099584745123),
    Elem::new(3553617946378538501),
    Elem::new(2597028497694375083),
    Elem::new(2979651941104721706),
    Elem::new(253616798519985065),
    Elem::new(1370021232923470642),
    Elem::new(3943804357627500431),
    Elem::new(3470981077741623958),
    Elem::new(1854964967325063111),
    Elem::new(1197249693832219),
    Elem::new(3527056534379669416),
    Elem::new(1887701019546911158),
    Elem::new(2766145581396778107),
    Elem::new(1016990334159655655),
    Elem::new(158848452448145448),
    Elem::new(4573320697113096609),
    Elem::new(339172111475040896),
    Elem::new(4125673985867455420),
    Elem::new(563299205473162260),
    Elem::new(851709166225279625),
    Elem::new(4608269226193503595),
    Elem::new(2830808784246083987),
    Elem::new(1076591561072585324),
    Elem::new(235739200846610049),
    Elem::new(1649676193944521693),
    Elem::new(2339596405623300027),
    Elem::new(1707820173576375748),
    Elem::new(3380670730166629106),
    Elem::new(3088480512605177675),
    Elem::new(3180683745830005003),
    Elem::new(2926724257787645746),
    Elem::new(521251149449564848),
    Elem::new(3009028257132948085),
    Elem::new(72978703814981802),
    Elem::new(2851349211715469057),
    Elem::new(2569997542955541582),
    Elem::new(2665010286680989858),
    Elem::new(728824379661011373),
    Elem::new(1720216422720850905),
    Elem::new(2928989358514834624),
    Elem::new(4476466838256582852),
    Elem::new(4041653846708678373),
    Elem::new(4168344518417076111),
    Elem::new(4429665048465423239),
    Elem::new(295247051602159802),
    Elem::new(727554669107684162),
    Elem::new(2407443928137107566),
    Elem::new(655747496043292742),
    Elem::new(1551494674838681171),
    Elem::new(1387396600083376556),
    Elem::new(940758067316249034),
    Elem::new(4450686462765534290),
    Elem::new(4096760798541777140),
    Elem::new(2515038793442679381),
    Elem::new(971605694227211718),
    Elem::new(821281803434447251),
    Elem::new(4609712905611926742),
    Elem::new(2096426140673445214),
    Elem::new(3817639475443866776),
    Elem::new(258969748815955179),
    Elem::new(1355310095316652733),
    Elem::new(2315068690932619422),
    Elem::new(3918141707140798437),
    Elem::new(1697264212502177137),
    Elem::new(4044824876362415802),
    Elem::new(3264496505022394879),
    Elem::new(1946627009912482512),
    Elem::new(2690411364862302808),
    Elem::new(4534232942876070536),
    Elem::new(1009622574027616318),
    Elem::new(4301101972836777449),
    Elem::new(1590815599697165662),
    Elem::new(2159301011805911239),
    Elem::new(1435452860042333278),
    Elem::new(1566729783179368445),
    Elem::new(2920523932761752258),
    Elem::new(843331706971896315),
    Elem::new(3448664465159312692),
    Elem::new(2168763454068411993),
    Elem::new(3201633911986746910),
    Elem::new(4260743805087178698),
    Elem::new(3526927132024577357),
    Elem::new(2255836709106891701),
    Elem::new(3701125056161739141),
    Elem::new(948651493661620260),
    Elem::new(2139607411868227425),
    Elem::new(3766422954436579098),
    Elem::new(1689530416674961583),
    Elem::new(457774883132572562),
    Elem::new(120445629740473687),
    Elem::new(1209580637351188708),
    Elem::new(2629109773221061967),
    Elem::new(2715010063402898243),
    Elem::new(1160744719825005087),
    Elem::new(1127826506047886846),
    Elem::new(2148788178603697633),
    Elem::new(1371973162285145797),
    Elem::new(3956318172610421420),
    Elem::new(547328897556167065),
    Elem::new(2232353561978615053),
    Elem::new(1581304874758809041),
    Elem::new(387248790691731957),
    Elem::new(260020143349140420),
    Elem::new(1009443840507929943),
    Elem::new(3215084459455245288),
    Elem::new(3024433299679532710),
    Elem::new(3527140711390372710),
    Elem::new(307580942112658745),
    Elem::new(2827060065635685245),
    Elem::new(1292690681954004320),
    Elem::new(1758593669918420122),
    Elem::new(2173801775385071007),
    Elem::new(2033197695055626993),
    Elem::new(4289220532384630442),
    Elem::new(4087627115498160646),
    Elem::new(3056338617113339133),
    Elem::new(4048550071481275796),
    Elem::new(2892271376516746565),
    Elem::new(4037187498228899126),
    Elem::new(2721326184892919115),
    Elem::new(866067715364256105),
    Elem::new(1769699722087355253),
    Elem::new(1356807491874308241),
    Elem::new(3262459351974810746),
    Elem::new(4280482461266704343),
    Elem::new(1117543795007105241),
    Elem::new(1381090154876037192),
    Elem::new(1816285702913485297),
    Elem::new(965814469124012272),
    Elem::new(200907059264672313),
    Elem::new(3003611550294524003),
    Elem::new(1109143160213152265),
    Elem::new(3785381539209306763),
    Elem::new(2036883046532445700),
    Elem::new(2584805196175419341),
    Elem::new(3985252615902005677),
    Elem::new(3898364955916101407),
    Elem::new(1132683848207674563),
    Elem::new(1747399943233717623),
    Elem::new(2758515115210883918),
    Elem::new(4106258251106087067),
    Elem::new(1286157122550710479),
    Elem::new(2493430987785513739),
    Elem::new(1354005386228765431),
    Elem::new(2288388698726255835),
    Elem::new(123600449691831235),
    Elem::new(1618224431325630875),
    Elem::new(2899118985702979192),
    Elem::new(1925033632267395673),
    Elem::new(145733994515791091),
    Elem::new(1638643632748764086),
    Elem::new(3211742485687848693),
    Elem::new(1486481891424469071),
    Elem::new(4305319955055661915),
    Elem::new(2444312092175336303),
    Elem::new(3821247856764969489),
    Elem::new(4406131836781765832),
    Elem::new(2716319974264317932),
    Elem::new(2276686824102525645),
    Elem::new(2801762430115098234),
    Elem::new(3579772259112851184),
    Elem::new(3669213265226670554),
    Elem::new(1035283046315581328),
    Elem::new(3824468564814547459),
    Elem::new(2543896318023422174),
    Elem::new(1051806701202150351),
    Elem::new(3091357600510051385),
    Elem::new(3253708036062126695),
    Elem::new(197227826521317921),
    Elem::new(4074205282929227638),
    Elem::new(1991385707311839477),
    Elem::new(1255109072720439416),
    Elem::new(3844413560364068856),
    Elem::new(3879438180131606394),
    Elem::new(2135853596559537047),
    Elem::new(1611760970223571159),
    Elem::new(944945505468573789),
    Elem::new(3983870682778320022),
    Elem::new(2263584238516468970),
    Elem::new(645843415148190357),
    Elem::new(2237496639076563777),
    Elem::new(2030043367192831841),
    Elem::new(161251782811342123),
    Elem::new(1399384627817087377),
    Elem::new(4123670404627488273),
    Elem::new(3414511391722298379),
    Elem::new(2628889030248029370),
    Elem::new(1196491838324700902),
    Elem::new(257534743906579094),
    Elem::new(1476116666269139939),
    Elem::new(2147277991299535194),
    Elem::new(308195035670871866),
    Elem::new(1371182253990908954),
    Elem::new(442950506471060009),
    Elem::new(2324448182202822693),
    Elem::new(33713533163809562),
    Elem::new(2206859863641510540),
    Elem::new(867496318631168678),
    Elem::new(1719513698205860933),
    Elem::new(1138365006603561845),
    Elem::new(3215424053441765166),
];



pub fn hash(input_sequence: &Vec<Elem>) -> [Elem; RATE] {
    rescue_prime_hash(input_sequence)
}

// ALGORITHMS FROM https://eprint.iacr.org/2020/1143
// ================================================================================================

// Algorithm 1
pub fn rescue_prime_hash(input_sequence: &Vec<Elem>) -> [Elem; RATE] {
    assert_eq!(0, input_sequence.len() % RATE);
    let mut state = [Elem::ZERO; STATE_WIDTH];
    let mut absorb_index = 0;
    while absorb_index < input_sequence.len() {
        for i in 0..RATE {
            state[i] += input_sequence[absorb_index];
            absorb_index += 1;
        }
        rescue_xlix_permutation(&mut state);
    }
    let mut output_sequence = [Elem::ZERO; RATE];
    output_sequence.copy_from_slice(&state[..RATE]);
    output_sequence
}

// Algorithm 2
#[allow(dead_code)]
pub fn rescue_prime_wrapper(input_sequence: &Vec<Elem>) -> [Elem; RATE] {
    let mut padded_input = input_sequence.clone();
    padded_input.push(Elem::ONE);
    while (padded_input.len() % RATE) != 0 {
        padded_input.push(Elem::ZERO);
    }
    rescue_prime_hash(&padded_input)
}

// Algorithm 3
pub fn rescue_xlix_permutation(state: &mut [Elem; STATE_WIDTH]) {
    for round in 0..NUM_ROUNDS {
        let round_const = &ROUND_CONSTANTS[round * STATE_WIDTH * 2..(round + 1) * STATE_WIDTH * 2];
        apply_sbox(state);
        matrix_mul(MDS, state);
        add_constants(state, &round_const, 0);
        apply_inv_sbox(state);
        matrix_mul(MDS, state);
        add_constants(state, &round_const, STATE_WIDTH);
    }
}

// TRACE CONSTRUCTION
// ================================================================================================

pub fn apply_round(state: &mut [Elem], round: usize) {
    // determine which round constants to use
    let tmp_round = round % NUM_ROUNDS;
    let round_constants = &ROUND_CONSTANTS[tmp_round * STATE_WIDTH * 2..(tmp_round + 1) * STATE_WIDTH * 2];

    // apply first half of Rescue round
    apply_sbox(state);
    matrix_mul(MDS, state);
    add_constants(state, &round_constants, 0);

    // apply second half of Rescue round
    apply_inv_sbox(state);
    matrix_mul(MDS, state);
    add_constants(state, &round_constants, STATE_WIDTH);
}

// TRANSITION CONSTRAINTS
// ================================================================================================

/// when flag = 1, enforces constraints for a single round of Rescue hash functions
pub fn enforce_round<E: FieldElement + From<Elem>>(
    result_slice: &mut [E],
    current_slice: &[E],
    next_slice: &[E],
    round_constants: &[E],
    flag: E,
) {
    // compute the state that should result from applying the first half of Rescue round
    // to the current state of the computation
    let mut step1 = [E::ZERO; STATE_WIDTH];
    step1.copy_from_slice(current_slice);
    apply_sbox(&mut step1);
    matrix_mul(MDS, &mut step1);
    for i in 0..STATE_WIDTH {
        step1[i] += round_constants[i];
    }

    // compute the state that should result from applying the inverse for the second
    // half for Rescue round to the next step of the computation
    let mut step2 = [E::ZERO; STATE_WIDTH];
    step2.copy_from_slice(next_slice);
    for i in 0..STATE_WIDTH {
        step2[i] -= round_constants[STATE_WIDTH + i];
    }
    matrix_mul(INV_MDS, &mut step2);
    apply_sbox(&mut step2);

    // make sure that the results are equal
    for i in 0..STATE_WIDTH {
        result_slice[i] += flag * (step2[i] - step1[i]);
    }
}

// ROUND CONSTANTS
// ================================================================================================

/// when flag = 1, enforces constraints for a single round of Rescue hash functions
pub fn enforce_first_round<E: FieldElement + From<Elem>>(
    result_slice: &mut [E],
    pixels: &[E],
    current_slice: &[E],
    next_slice: &[E],
    round_constants: &[E],
    flag: E,
) {
    // compute the state that should result from applying the first half of Rescue round
    // to the current state of the computation
    let mut step1 = [E::ZERO; STATE_WIDTH];
    step1.copy_from_slice(current_slice);
    for i in 0..RATE {
        step1[i] += pixels[i];
    }
    apply_sbox(&mut step1);
    matrix_mul(MDS, &mut step1);
    for i in 0..STATE_WIDTH {
        step1[i] += round_constants[i];
    }

    // compute the state that should result from applying the inverse for the second
    // half for Rescue round to the next step of the computation
    let mut step2 = [E::ZERO; STATE_WIDTH];
    step2.copy_from_slice(next_slice);
    for i in 0..STATE_WIDTH {
        step2[i] -= round_constants[STATE_WIDTH + i];
    }
    matrix_mul(INV_MDS, &mut step2);
    apply_sbox(&mut step2);

    // make sure that the results are equal
    for i in 0..STATE_WIDTH {
        result_slice[i] += flag * (step2[i] - step1[i]);
    }
}

/// returns round constants arranged in column-major form for periodic columns
pub fn get_round_constants_periodic(cycle_length: usize, shift: usize) -> Vec<Vec<Elem>> {
    let mut constants = Vec::new();
    for _ in 0..(STATE_WIDTH * 2) {
        constants.push(vec![Elem::ZERO; cycle_length]);
    }
    for i in 0..NUM_ROUNDS {
        for j in 0..(STATE_WIDTH * 2) {
            constants[j][(i + shift) % cycle_length] = ROUND_CONSTANTS[i * STATE_WIDTH * 2 + j];
        }
    }
    constants
}

// HELPER FUNCTIONS
// ================================================================================================

fn add_constants(state: &mut [Elem], round_constants: &[Elem], offset: usize) {
    for i in 0..STATE_WIDTH {
        state[i] += round_constants[offset + i];
    }
}

fn apply_sbox<E: FieldElement>(state: &mut [E]) {
    for i in 0..STATE_WIDTH {
        state[i] = state[i].exp(ALPHA.into());
    }
}

fn apply_inv_sbox(state: &mut [Elem]) {
    for i in 0..STATE_WIDTH {
        state[i] = state[i].exp(INV_ALPHA);
    }
}

fn matrix_mul<E: FieldElement + From<Elem>>(matrix: [Elem; STATE_WIDTH * STATE_WIDTH], state: &mut [E]) {
    let mut result = [E::ZERO; STATE_WIDTH];
    for row in 0..STATE_WIDTH {
        for col in 0..STATE_WIDTH {
            result[row] += E::from(matrix[row * STATE_WIDTH + col]) * state[col];
        }
    }
    state.copy_from_slice(&result);
}
