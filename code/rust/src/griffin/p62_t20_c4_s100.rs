// Griffin definition according to the paper
// Inspired by https://github.com/novifinancial/winterfell/blob/main/examples/src/rescue/rescue.rs
// Parameters derived using sage script in thesis repo

// Parameters
//   p   .. 4611624995532046337 (prime from winterfell::math::fields::f62)
//   t   .. 20
//   security at least 100 bit
//   rate and capacity do not influence parameter generation and can be chosen freely.

use winterfell::math::{fields::f62::BaseElement, FieldElement};

pub type Elem = BaseElement;

// Griffin CONSTANTS
// ================================================================================================

pub const NUM_ROUNDS: usize = 8;
pub const STATE_WIDTH: usize = 20;
pub const CAPACITY: usize = 4;
pub const RATE: usize = STATE_WIDTH - CAPACITY;
const D: u32 = 3;
const INV_D: u64 = 3074416663688030891;

const MAT: [Elem; STATE_WIDTH * STATE_WIDTH] = [
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
    Elem::new(4),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(2),
    Elem::new(1),
    Elem::new(1),
    Elem::new(3),
    Elem::new(4),
    Elem::new(2),
    Elem::new(2),
    Elem::new(6),
];

const INV_MAT: [Elem; STATE_WIDTH * STATE_WIDTH] = [
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
    Elem::new(3403818449083177058),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3008536306609001658),
    Elem::new(856444642027380034),
    Elem::new(1932490474318190846),
    Elem::new(3315977972977804747),
    Elem::new(3403818449083177058),
    Elem::new(329401785395146167),
    Elem::new(4172422615005184781),
    Elem::new(1866610117239161613),
];

const ROUND_CONSTANTS: [Elem; STATE_WIDTH * NUM_ROUNDS] = [
    Elem::new(3158844352288017369),
    Elem::new(1195317911825411486),
    Elem::new(4608205121057886279),
    Elem::new(4008181692568088186),
    Elem::new(1017954942371112343),
    Elem::new(1040939723347347663),
    Elem::new(3439273042787950109),
    Elem::new(2938341972827614785),
    Elem::new(1054982074439128355),
    Elem::new(3378941598864555180),
    Elem::new(2655968627444521873),
    Elem::new(3496395394053647545),
    Elem::new(3224656810721129303),
    Elem::new(1409457225689559228),
    Elem::new(399784346908802669),
    Elem::new(2246468338867711618),
    Elem::new(2416421687084831339),
    Elem::new(3428136709650469831),
    Elem::new(4074697826219704129),
    Elem::new(1883685086274227575),
    Elem::new(4534624711249925081),
    Elem::new(2432723871866042896),
    Elem::new(2124532709347037506),
    Elem::new(2661205267268058692),
    Elem::new(4131330586801945043),
    Elem::new(4317709368381444920),
    Elem::new(1311980128349755585),
    Elem::new(3894459409720878477),
    Elem::new(1273089151069727973),
    Elem::new(2754117850078380637),
    Elem::new(4155398919935078309),
    Elem::new(1602817949587807433),
    Elem::new(3483922029577050900),
    Elem::new(4086381296415431721),
    Elem::new(3694431514100124504),
    Elem::new(284397335042238801),
    Elem::new(1914738171044430233),
    Elem::new(4367396245930867973),
    Elem::new(1228756722162514976),
    Elem::new(3985334418783874519),
    Elem::new(1881353522970783983),
    Elem::new(1439406162131278831),
    Elem::new(4032157944401576016),
    Elem::new(2333963439210464894),
    Elem::new(858583416067686119),
    Elem::new(3778590617795793098),
    Elem::new(1936179684747344016),
    Elem::new(1342015051341116620),
    Elem::new(2353927619244796484),
    Elem::new(4507090825909340209),
    Elem::new(1196284001547131168),
    Elem::new(3749010879697097039),
    Elem::new(89183101871242148),
    Elem::new(4572854387208232026),
    Elem::new(3906677153589125867),
    Elem::new(2354165545578465165),
    Elem::new(2415674879962838905),
    Elem::new(1692898743350361972),
    Elem::new(2496776734953641068),
    Elem::new(303543362880941024),
    Elem::new(2105285343540735313),
    Elem::new(3812661498355819711),
    Elem::new(1038909497262650193),
    Elem::new(3186538977226541115),
    Elem::new(2605339311525417104),
    Elem::new(795101678427820090),
    Elem::new(3544609697607594986),
    Elem::new(3594803620709084859),
    Elem::new(4448726497313701264),
    Elem::new(2931550967036695555),
    Elem::new(3538676793404272671),
    Elem::new(2507283441398306979),
    Elem::new(1306215874097670918),
    Elem::new(4454470778316904368),
    Elem::new(552277892431334535),
    Elem::new(123225674281188203),
    Elem::new(601578661784311950),
    Elem::new(520870900795522935),
    Elem::new(1531944673051993903),
    Elem::new(1508718586719741480),
    Elem::new(1260401647369688278),
    Elem::new(4411214861045822893),
    Elem::new(3920679138527518259),
    Elem::new(2308231751609902005),
    Elem::new(2725034957899313851),
    Elem::new(2810607893341136336),
    Elem::new(205638535463904355),
    Elem::new(133870829026577490),
    Elem::new(357210935630277945),
    Elem::new(1889904600231838415),
    Elem::new(656188838679853341),
    Elem::new(4567491434612218733),
    Elem::new(3070462243542669035),
    Elem::new(2537529499885977366),
    Elem::new(2945538403710104305),
    Elem::new(3352604226624312500),
    Elem::new(2472711160632772909),
    Elem::new(867879691912588009),
    Elem::new(1128449196792447454),
    Elem::new(1477928528264287843),
    Elem::new(2354674075944635342),
    Elem::new(1398882751905393244),
    Elem::new(3735629361086081741),
    Elem::new(2567674661098547547),
    Elem::new(3836335738535998458),
    Elem::new(2737394514168283526),
    Elem::new(1243766280872533763),
    Elem::new(4020226560229530127),
    Elem::new(1001424016691137677),
    Elem::new(4564868917749409365),
    Elem::new(633844774803411279),
    Elem::new(74838372323834019),
    Elem::new(399418457437360005),
    Elem::new(1235365153576485938),
    Elem::new(4609750581254175951),
    Elem::new(3196558139150637545),
    Elem::new(2681346939847781864),
    Elem::new(2336036859429982173),
    Elem::new(3481722409707435073),
    Elem::new(3501495427101835964),
    Elem::new(4463773674166549717),
    Elem::new(3512074971553513487),
    Elem::new(3441599517287043542),
    Elem::new(807064436920401284),
    Elem::new(678949813109769382),
    Elem::new(1105737893882376378),
    Elem::new(2217552489187700286),
    Elem::new(110078626676698051),
    Elem::new(448296076115746240),
    Elem::new(1404230712275922896),
    Elem::new(1111076189280952115),
    Elem::new(3475268832661646663),
    Elem::new(4066944272981415223),
    Elem::new(1925434941739275147),
    Elem::new(1692240912201072761),
    Elem::new(1213362044456530588),
    Elem::new(1055445907361178564),
    Elem::new(2948098034763003933),
    Elem::new(388000301941336801),
    Elem::new(4064075334971188924),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
    Elem::new(0),
];

const ALPHAS: [Elem; STATE_WIDTH] = [
    Elem::new(0),
    Elem::new(0),
    Elem::new(863576742818374289),
    Elem::new(1727153485636748578),
    Elem::new(2590730228455122867),
    Elem::new(3454306971273497156),
    Elem::new(4317883714091871445),
    Elem::new(569835461378199397),
    Elem::new(1433412204196573686),
    Elem::new(2296988947014947975),
    Elem::new(3160565689833322264),
    Elem::new(4024142432651696553),
    Elem::new(276094179938024505),
    Elem::new(1139670922756398794),
    Elem::new(2003247665574773083),
    Elem::new(2866824408393147372),
    Elem::new(3730401151211521661),
    Elem::new(4593977894029895950),
    Elem::new(845929641316223902),
    Elem::new(1709506384134598191),
];

const BETAS: [Elem; STATE_WIDTH] = [
    Elem::new(0),
    Elem::new(0),
    Elem::new(3248218705333235144),
    Elem::new(3769624830268847902),
    Elem::new(1564218374806838274),
    Elem::new(1243624334479252597),
    Elem::new(2807842709286090871),
    Elem::new(1645248503695306759),
    Elem::new(2367466713238946598),
    Elem::new(362872342384964051),
    Elem::new(243090386665405455),
    Elem::new(2008120846080270810),
    Elem::new(1046338725097513779),
    Elem::new(1969369019249180699),
    Elem::new(165586733003225233),
    Elem::new(246616861891693718),
    Elem::new(2212459405914586154),
    Elem::new(1451489369539856204),
    Elem::new(2575331748299550205),
    Elem::new(972361546661621820),
];

const LAMBDAS: [Elem; 2] = [
    Elem::new(4104176352712844569),
    Elem::new(4365789504127854421),
];


pub fn hash(input_sequence: &Vec<Elem>) -> [Elem; RATE] {
    griffin_hash(input_sequence)
}

// ALGORITHMS for computing Griffin
// ================================================================================================

pub fn griffin_hash(input_sequence: &Vec<Elem>) -> [Elem; RATE] {
    assert_eq!(0, input_sequence.len() % RATE);
    let mut state = [Elem::ZERO; STATE_WIDTH]; // TODO
    let mut absorb_index = 0;
    while absorb_index < input_sequence.len() {
        for i in 0..RATE {
            state[i] += input_sequence[absorb_index];
            absorb_index += 1;
        }
        griffin_permutation(&mut state);
    }
    let mut output_sequence = [Elem::ZERO; RATE];
    output_sequence.copy_from_slice(&state[..RATE]);
    output_sequence
}

pub fn griffin_permutation(state: &mut [Elem; STATE_WIDTH]) {
    for i in 0..NUM_ROUNDS {
        apply_round(state, i);
    }
}

// TRACE CONSTRUCTION
// ================================================================================================

pub fn apply_round(state: &mut [Elem], round: usize) {
    // determine which round constants to use
    let tmp_round = round % NUM_ROUNDS;
    let round_constants = &ROUND_CONSTANTS[tmp_round * STATE_WIDTH..(tmp_round + 1) * STATE_WIDTH];

    // the first round multiplies the state additionally with the matrix before getting started
    if tmp_round == 0 {
        matrix_mul(MAT, state);
    }

    // now one round
    // non linear layer
    state[0] = state[0].exp(D.into());
    state[1] = state[1].exp(INV_D);
    let l: Elem = LAMBDAS[0] * state[0] + LAMBDAS[1] * state[1];
    for i in 2..STATE_WIDTH {
        state[i] = state[i] * (l * l + ALPHAS[i] * l + BETAS[i]);
    }
    // matrix multiplication
    matrix_mul(MAT, state);
    // adding round constants
    for i in 0..STATE_WIDTH {
        state[i] += round_constants[i];
    }
}


// TRANSITION CONSTRAINTS
// ================================================================================================

/// when flag = 1, enforces constraints for the first round of Griffin-π
/// performs M S M c
#[allow(dead_code)]
pub fn enforce_first_round_plus_absorb<E: FieldElement + From<Elem>>(
    result_slice: &mut [E],
    pixels: &[E],
    current_slice: &[E],
    next_slice: &[E],
    round_constants: &[E],
    flag: E,
) {
    // approach from the left side: multiply by MAT
    let mut left = [E::ZERO; STATE_WIDTH];
    left.copy_from_slice(current_slice);
    for i in 0..RATE {
        left[i] += pixels[i];
    }
    matrix_mul(MAT, &mut left);

    // now we can enforce one round
    enforce_round(result_slice, &left, next_slice, round_constants, flag);
}

/// when flag = 1, enforces constraints for the first round of Griffin-π
/// performs M S M c
#[allow(dead_code)]
pub fn enforce_first_round<E: FieldElement + From<Elem>>(
    result_slice: &mut [E],
    current_slice: &[E],
    next_slice: &[E],
    round_constants: &[E],
    flag: E,
) {
    // approach from the left side: multiply by MAT
    let mut left = [E::ZERO; STATE_WIDTH];
    left.copy_from_slice(current_slice);
    matrix_mul(MAT, &mut left);

    // now we can enforce one round
    enforce_round(result_slice, &left, next_slice, round_constants, flag);
}

/// when flag = 1, enforces constraints for one other round of Griffin-π
/// performs S M c
pub fn enforce_round<E: FieldElement + From<Elem>>(
    result_slice: &mut [E],
    current_slice: &[E],
    next_slice: &[E],
    round_constants: &[E],
    flag: E,
) {
    // approach from the right side: subtract constants, then multiply by INV_MAT
    let mut right = [E::ZERO; STATE_WIDTH];
    right.copy_from_slice(next_slice);
    for i in 0..STATE_WIDTH {
        right[i] -= round_constants[i];
    }
    matrix_mul(INV_MAT, &mut right);

    // now we can enforce the nonlinear layer
    enforce_non_linear(result_slice, current_slice, &right, flag);
}

fn enforce_non_linear<E: FieldElement + From<Elem>>(
    result_slice: &mut [E],
    x: &[E],
    y: &[E],
    flag: E,
) {
    result_slice[0] += flag * (y[0] - x[0].exp(D.into()));
    result_slice[1] += flag * (x[1] - y[1].exp(D.into()));
    let l: E = E::from(LAMBDAS[0]) * y[0] + E::from(LAMBDAS[1]) * y[1]; // function L(x[0], x[1])
    for i in 2..STATE_WIDTH {
        result_slice[i] += flag * (x[i] * (l * l + E::from(ALPHAS[i]) * l + E::from(BETAS[i])) - y[i]);
    }
}

// ROUND CONSTANTS
// ================================================================================================

/// returns round constants arranged in column-major form for periodic columns
pub fn get_round_constants_periodic(cycle_length: usize, shift: usize) -> Vec<Vec<Elem>> {
    let mut constants = Vec::new();
    for _ in 0..STATE_WIDTH {
        constants.push(vec![Elem::ZERO; cycle_length]);
    }
    for i in 0..NUM_ROUNDS {
        for j in 0..STATE_WIDTH {
            constants[j][(i + shift) % cycle_length] = ROUND_CONSTANTS[i * STATE_WIDTH + j];
        }
    }
    constants
}

// HELPER FUNCTIONS
// ================================================================================================

fn matrix_mul<E: FieldElement + From<Elem>>(matrix: [Elem; STATE_WIDTH * STATE_WIDTH], state: &mut [E]) {
    let mut result = [E::ZERO; STATE_WIDTH];
    for row in 0..STATE_WIDTH {
        for col in 0..STATE_WIDTH {
            result[row] += E::from(matrix[row * STATE_WIDTH + col]) * state[col];
        }
    }
    state.copy_from_slice(&result);
}